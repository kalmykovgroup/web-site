# –°–º–µ–Ω–∞ –¥–æ–º–µ–Ω–∞

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∫ —Å–º–µ–Ω–∏—Ç—å –¥–æ–º–µ–Ω –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ nginx **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —à–∞–±–ª–æ–Ω–∞, –ø–æ–¥—Å—Ç–∞–≤–ª—è—è –∑–Ω–∞—á–µ–Ω–∏–µ `DOMAIN` –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

```
.env —Ñ–∞–π–ª
    ‚Üì
docker-compose.yml —á–∏—Ç–∞–µ—Ç DOMAIN
    ‚Üì
nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç DOMAIN –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
    ‚Üì
docker-entrypoint.sh –≤—ã–∑—ã–≤–∞–µ—Ç generate-config.sh
    ‚Üì
generate-config.sh —Å–æ–∑–¥–∞–µ—Ç default.conf —Å –Ω–æ–≤—ã–º –¥–æ–º–µ–Ω–æ–º
    ‚Üì
nginx –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
```

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

```bash
docker-compose down
```

### –®–∞–≥ 2: –ò–∑–º–µ–Ω–∏—Ç–µ .env —Ñ–∞–π–ª

```bash
nano .env
```

–ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
```env
DOMAIN=–Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru
EMAIL=your@email.com
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª (Ctrl+O, Enter, Ctrl+X).

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ A-–∑–∞–ø–∏—Å–∏ –Ω–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä:

```bash
nslookup –Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru
nslookup www.–Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru
```

### –®–∞–≥ 4: –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞:

```bash
# –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã!
sudo rm -rf certbot/conf/live/*
sudo rm -rf certbot/conf/archive/*
sudo rm -rf certbot/conf/renewal/*
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

```bash
docker compose up -d
```

Nginx –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. ‚úÖ –ü—Ä–æ—á–∏—Ç–∞–µ—Ç DOMAIN –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å –Ω–æ–≤—ã–º –¥–æ–º–µ–Ω–æ–º
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
4. ‚úÖ –ï—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –Ω–µ—Ç - –ø–æ–ª—É—á–∏—Ç –Ω–æ–≤—ã–π –æ—Ç Let's Encrypt
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç HTTPS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ nginx –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω
docker-compose exec nginx cat /etc/nginx/conf.d/default.conf | grep server_name

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# server_name –Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru www.–Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru;

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP ‚Üí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç
curl -I http://–Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTPS
curl -I https://–Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
docker-compose exec nginx openssl x509 -noout -subject -in /etc/letsencrypt/live/–Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru/fullchain.pem
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –¥–æ–º–µ–Ω –±–µ–∑ –ø–æ–ª–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:

```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç—å .env
nano .env

# 2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose up -d --force-recreate nginx

# SSL –Ω–∞—Å—Ç—Ä–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ nginx
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–æ–º–µ–Ω–∞

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose exec nginx env | grep DOMAIN

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
docker-compose exec nginx cat /etc/nginx/conf.d/default.conf

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞ nginx (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–æ–π –¥–æ–º–µ–Ω –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω)
docker-compose logs nginx | grep "–î–æ–º–µ–Ω:"
```

## –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –¥–æ–º–µ–Ω—É

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# 2. –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ .env
nano .env
# DOMAIN=volnaya-28.ru
# EMAIL=admin@kalmykov-group.ru

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose up -d

# 4. –°—Ç–∞—Ä—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–π–¥–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

## –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–µ–Ω–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–µ–Ω–æ–≤ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç–æ–≤

```bash
# –ü—Ä–æ–µ–∫—Ç 1
cd /opt/project1
nano .env  # DOMAIN=domain1.com
docker-compose up -d

# –ü—Ä–æ–µ–∫—Ç 2 (–¥—Ä—É–≥–∏–µ –ø–æ—Ä—Ç—ã!)
cd /opt/project2
nano .env  # DOMAIN=domain2.com
nano docker-compose.yml  # –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç—ã 80‚Üí8080, 443‚Üí8443
docker-compose up -d
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û–¥–∏–Ω nginx –¥–ª—è –≤—Å–µ—Ö

–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π nginx —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤ –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã–µ –±—ç–∫–µ–Ω–¥—ã. –≠—Ç–æ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞.

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞ 1: Nginx –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π –¥–æ–º–µ–Ω

**–ü—Ä–∏—á–∏–Ω–∞**: docker-compose –Ω–µ –ø–µ—Ä–µ–¥–∞–ª –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ**:
```bash
docker-compose down
docker-compose up -d --force-recreate nginx
```

### –û—à–∏–±–∫–∞ 2: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –≤—ã–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: DNS –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è –∏–ª–∏ Let's Encrypt –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä—ã–π IP.

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü–æ–¥–æ–∂–¥–∏—Ç–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS (–¥–æ 48 —á–∞—Å–æ–≤, –æ–±—ã—á–Ω–æ 5-15 –º–∏–Ω—É—Ç)
nslookup –Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç
sudo ufw status

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è ACME challenge
curl http://–Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru/.well-known/acme-challenge/test
```

### –û—à–∏–±–∫–∞ 3: –°—Ç–∞—Ä—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: nginx –Ω–∞—à–µ–ª —Å—Ç–∞—Ä—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ.

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo rm -rf certbot/conf/live/*
sudo rm -rf certbot/conf/archive/*
sudo rm -rf certbot/conf/renewal/*

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å - –Ω–æ–≤—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
docker compose restart nginx
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã

```bash
# –õ–æ–≥–∏ nginx
docker-compose logs -f nginx

# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx
docker-compose exec nginx nginx -t

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose exec nginx env
```

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–º–µ–Ω—ã –¥–æ–º–µ–Ω–∞ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç:

```bash
#!/bin/bash
# change-domain.sh

NEW_DOMAIN=$1
NEW_EMAIL=$2

if [ -z "$NEW_DOMAIN" ] || [ -z "$NEW_EMAIL" ]; then
    echo "Usage: ./change-domain.sh –Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru your@email.com"
    exit 1
fi

echo "Changing domain to: $NEW_DOMAIN"

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker compose down

# –û–±–Ω–æ–≤–∏—Ç—å .env
sed -i "s/DOMAIN=.*/DOMAIN=$NEW_DOMAIN/" .env
sed -i "s/EMAIL=.*/EMAIL=$NEW_EMAIL/" .env

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
read -p "Delete old SSL certificates? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    sudo rm -rf certbot/conf/live/*
    sudo rm -rf certbot/conf/archive/*
    sudo rm -rf certbot/conf/renewal/*
fi

# –ó–∞–ø—É—Å—Ç–∏—Ç—å - SSL –Ω–∞—Å—Ç—Ä–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
docker compose up -d

echo "‚úÖ Domain changed to: $NEW_DOMAIN"
echo "üåê Check: https://$NEW_DOMAIN"
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
chmod +x change-domain.sh
./change-domain.sh –Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω.ru your@email.com
```

## –†–µ–∑—é–º–µ

‚úÖ **–î–∞, —Å–º–µ–Ω–∞ –¥–æ–º–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

–ü—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç–µ `DOMAIN` –≤ `.env` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
nano .env                    # –ò–∑–º–µ–Ω–∏—Ç—å DOMAIN=
docker compose down
docker compose up -d         # Nginx –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç SSL
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è **–ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
